"use strict";require(["jquery","weui","common"],function(n,s,o){console.debug(o);var i=o.util,d=(o.api,o.cache),r=o.const,t=o.component,a=(o.wx,Object.assign(i.getQuery(),i.getQuery(location.hash))),l=(i.getCalendarDate(),{});try{(l=JSON.parse(sessionStorage.getItem("baseUser"))||{}).orguser=l.orguser||{teacher:{}}}catch(o){}var c=function(){function t(o){var t={DEFAULT_AVATAR:"/shijiwxy/weixin/images/defaultHead.jpg",API_HOST:window.BaseWTDomain||window.domainName||"https://t.shijiwxy.5tree.cn",API_PATH:"",USER:{TOKEN:o.token||"",UDID:o.udid||"",USER_ID:o.orguser.user_id||"",TEACHER_ID:o.orguser.teacher.tech_id||"",ORG_ID:o.orguser.org_id||"",RILDS:(o.orguser.rlids||"").split(",").filter(function(o){return""!==o}),VERSION:"3",IDENTITY:o.orguser.identity||""},APP:{TYPE:{STUDENT:"4",ESCROW:"5",TEACHER:"6"}},ERROR_IMAGE:"/accesscontrol/static/assets/images/not-found-image.png"};return t.USER.IS_SYSTEM_ADMIN=99==t.USER.IDENTITY,t.USER.IS_ADMIN=t.USER.IS_SYSTEM_ADMIN||t.USER.RILDS.includes("1")||t.USER.RILDS.includes("2")||t.USER.RILDS.includes("10")||t.USER.RILDS.includes("19"),t.USER.IS_GRADEGB=t.USER.RILDS.includes("5"),t.USER.IS_CLASSGB=t.USER.RILDS.includes("4"),Object.defineProperties(t,{DEBUG:{value:!0,writable:!1},VERSION:{value:"1.4.2",writable:!1}}),t}var e=t(l);return e.reset=function(o){Object.assign(e,t(o))},e}();document.body.className="on",function(t){if(i.isEmpty(c.USER.TOKEN)){var e=s.loading("加载中");getUserLoginBaseInfoOfOpenid(a.openid,a.org_id,a.identity,function(o){d.set("baseUser",o,r.SESSION_STORAGE),c.reset(o),e.hide(function(){t({})})},!0)}else t({})}(function(o){Object.assign(c,o),t.create(document.body),function(i){var t=window,e=document,d=i(t),r=i(e);i.fn.dropload=function(o){return new n(this,o)};var n=function(o,t){var e=this;e.$element=o,e.upInsertDOM=!1,e.loading=!1,e.isLockUp=!1,e.isLockDown=!1,e.isData=!0,e._scrollTop=0,e._threshold=0,e.init(t)};function a(o){o.touches||(o.touches=o.originalEvent.touches||[{pageX:o.originalEvent.pageX,pageY:o.originalEvent.pageY}])}function l(o){""!=o.opts.loadDownFn&&o.opts.autoLoad&&o._scrollContentHeight-o._threshold<=o._scrollWindowHeight&&p(o)}function c(o){o.opts.scrollArea!=t&&(o._scrollWindowHeight=o.$element.height()),o._scrollContentHeight=o.$element[0].scrollHeight}function p(o){o.isData&&(o.direction="up",o.$domDown.html(o.opts.domDown.domLoad),o.loading=!0,o.opts.loadDownFn(o))}function u(o,t){o.css({"-webkit-transition":"all "+t+"ms",transition:"all "+t+"ms"})}n.prototype.init=function(o){var n=this;n.opts=i.extend(!0,{},{scrollArea:n.$element,domUp:{domClass:"dropload-up",domRefresh:'<div class="dropload-refresh">↓下拉刷新</div>',domUpdate:'<div class="dropload-update">↑释放更新</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>'},domDown:{domClass:"dropload-down",domRefresh:'<div class="dropload-refresh">↑上拉加载更多</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>',domNoData:'<div class="dropload-noData">没有更多数据了</div>'},autoLoad:!0,distance:50,threshold:"",loadUpFn:"",loadDownFn:""},o),""!=n.opts.loadDownFn&&(n.$domDown=i('<div class="'+n.opts.domDown.domClass+'">'+n.opts.domDown.domRefresh+"</div>"),n.$element.append(n.$domDown)),n.$domDown&&""===n.opts.threshold?n._threshold=Math.floor(1*n.$domDown.height()/3):n._threshold=n.opts.threshold,n._threshold+=5,n.opts.scrollArea==t?(n.$scrollArea=d,n._scrollContentHeight=r.height(),n._scrollWindowHeight=e.documentElement.clientHeight):(n.$scrollArea=n.opts.scrollArea,n._scrollContentHeight=n.$element[0].scrollHeight,n._scrollWindowHeight=n.$scrollArea.height()),l(n),d.on("resize",function(){clearTimeout(n.timer),n.timer=setTimeout(function(){n.opts.scrollArea==t?n._scrollWindowHeight=t.innerHeight:n._scrollWindowHeight=n.$element.height(),l(n)},150)});var s=!1;n.$element.on("mousedown touchstart",function(o){var t,e;s=!0,n.loading||(a(o),t=o,(e=n)._startY=t.touches[0].pageY,e.touchScrollTop=e.$scrollArea.scrollTop())}),n.$element.on("mousemove touchmove",function(o){s&&(n.loading||(a(o),function(o,t){t._curY=o.touches[0].pageY,t._moveY=t._curY-t._startY,0<t._moveY?t.direction="down":t._moveY<0&&(t.direction="up");var e=Math.abs(t._moveY);""!=t.opts.loadUpFn&&t.touchScrollTop<=0&&"down"==t.direction&&!t.isLockUp&&(o.preventDefault(),t.$domUp=i("."+t.opts.domUp.domClass),t.upInsertDOM||(t.$element.prepend('<div class="'+t.opts.domUp.domClass+'"></div>'),t.upInsertDOM=!0),u(t.$domUp,0),e<=t.opts.distance?(t._offsetY=e,t.$domUp.html(t.opts.domUp.domRefresh)):e>t.opts.distance&&e<=2*t.opts.distance?(t._offsetY=t.opts.distance+.5*(e-t.opts.distance),t.$domUp.html(t.opts.domUp.domUpdate)):t._offsetY=t.opts.distance+.5*t.opts.distance+.2*(e-2*t.opts.distance),t.$domUp.css({height:t._offsetY}))}(o,n)))}),n.$element.on("mouseup touchend",function(){var o,t;s=!1,n.loading||(o=n,t=Math.abs(o._moveY),""!=o.opts.loadUpFn&&o.touchScrollTop<=0&&"down"==o.direction&&!o.isLockUp&&(u(o.$domUp,300),t>o.opts.distance?(o.$domUp.css({height:o.$domUp.children().height()}),o.$domUp.html(o.opts.domUp.domLoad),o.loading=!0,o.opts.loadUpFn(o)):o.$domUp.css({height:"0"}).on("webkitTransitionEnd mozTransitionEnd transitionend",function(){o.upInsertDOM=!1,i(this).remove()}),o._moveY=0))}),n.$scrollArea.on("scroll",function(){n._scrollTop=n.$scrollArea.scrollTop(),c(n),""!=n.opts.loadDownFn&&!n.loading&&!n.isLockDown&&n._scrollContentHeight-n._threshold<=n._scrollWindowHeight+n._scrollTop&&p(n)})},n.prototype.lock=function(o){var t=this;void 0===o?"up"==t.direction?t.isLockDown=!0:"down"==t.direction?t.isLockUp=!0:(t.isLockUp=!0,t.isLockDown=!0):"up"==o?t.isLockUp=!0:"down"==o&&(t.isLockDown=!0)},n.prototype.unlock=function(){this.isLockUp=!1,this.isLockDown=!1},n.prototype.noData=function(o){void 0===o||1==o?this.isData=!1:0==o&&(this.isData=!0)},n.prototype.resetload=function(){var o=this;"down"==o.direction&&o.upInsertDOM?o.$domUp.css({height:"0"}).on("webkitTransitionEnd mozTransitionEnd transitionend",function(){o.loading=!1,o.upInsertDOM=!1,i(this).remove(),c(o)}):"up"==o.direction&&(o.loading=!1),o.isData?(o.$domDown.html(o.opts.domDown.domRefresh),c(o),l(o)):o.$domDown.html(o.opts.domDown.domNoData)},n.prototype.refresh=function(){var o=this;o.upInsertDOM||(o.$element.prepend('<div class="'+o.opts.domUp.domClass+'"></div>'),o.upInsertDOM=!0),o.direction="down",o.$domUp=i("."+o.opts.domUp.domClass).html(o.opts.domUp.domLoad).css("transition","linear .1s"),o.$domUp.css({height:o.$domUp.children().height()}),o.loading=!0,o.$element[0].scrollTo(0,0),o.opts.loadUpFn(o)}}(window.Zepto||window.jQuery),t.loading=function(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"加载中";return s.loading(o)},t.appoint("body"),t.scroll=function(o){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};e=Object.assign({refer:e.refer||window,onRefresh:function(o){o()},onContinue:function(o){o()}},e);var t=n(o).dropload({scrollArea:e.refer,loadDownFn:function(t){t.lock("up"),e.onContinue(function(){var o=0<arguments.length&&void 0!==arguments[0]&&arguments[0];t.unlock(),t.noData(o),t.resetload()})},loadUpFn:function(t){t.lock("down"),e.onRefresh(function(){var o=0<arguments.length&&void 0!==arguments[0]&&arguments[0];t.unlock(),t.noData(o),t.resetload()})}});return t},console.log("main")})});